
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="index, follow" />

  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro:300,400,400i,700" rel="stylesheet">

    <link rel="stylesheet/less" type="text/css" href="https://blog.solvik.fr/theme/stylesheet/style.less">
    <script src="//cdnjs.cloudflare.com/ajax/libs/less.js/2.5.1/less.min.js" type="text/javascript"></script>

  <link rel="stylesheet" type="text/css" href="https://blog.solvik.fr/theme/pygments/monokai.min.css">
  <link rel="stylesheet" type="text/css" href="https://blog.solvik.fr/theme/font-awesome/css/font-awesome.min.css">


    <link href="https://blog.solvik.fr/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="A Pelican Blog Atom">




    <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#3338db">
    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#3338db">
    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Microsoft EDGE -->
    <meta name="msapplication-TileColor" content="#3338db">

<meta name="author" content="Solvik Blum" />
<meta name="description" content="Last night, I was asked if I could setup some frontend to make some stats out of a CSV. In a more interactive and collaborative way than Excel. I was first asked to do a small Django project since it used to be my goto technology at the time. But for this need, the use of Elasticsearch was perfect and Kibana helped me to not develop any frontend and solve a lot of time. The CSV export looked like this but had at least 30 columns and 200k lines: Column1;Colum2;Column3 1;2;3 a;b;c blih;blah;bluh Python way to push the CSV to Elasticsearch Elasticsearch requires JSON documents, so the first step was to convert the CSV to json. Instead of writing a CSV to JSON parser, I used the pandas library which makes the whole process a lot easier and faster (the csv file had hundreds of thousands of lines). And by looking at the official elasticsearch python SDK, I just needed to transform the whole CSV into a dict. import sys import pandas as pd import argparse from elasticsearch import Elasticsearch, helpers def main(): parser = argparse.ArgumentParser(description=&#39;Process some integers.&#39;) parser.add_argument(&#39;filename&#39;, type=str, help=&#39;filename to parse&#39;) parser.add_argument(&#39;index&#39;, type=str, help=&#39;index name to use&#39;) args = parser.parse_args() filename = args.filename index_name = args.index # initiate Elasticsearch connection es = Elasticsearch() # parse the csv with pandas df = pd.read_csv(filename, sep=&#39;;&#39;, error_bad_lines=False) # trim whitespace and stuff data_frame_trimmed = df.apply(lambda x: x.str.strip() if x.dtype == &#34;object&#34; else x) # replace `nan` values with empty string data_frame_trimmed = df.fillna(&#39;&#39;) # transform the whole data frame into a huge python dict records = data_frame_trimmed.to_dict(orient=&#39;records&#39;) # use bulk actions to push the data actions = [] for i, r in enumerate(records): actions.append({&#34;_index&#34;: index_name, &#34;_type&#34;: &#34;vuln&#34;, &#34;_id&#34;: i, &#34;_source&#34;: r}) ret = helpers.bulk(es, actions=actions) print(ret) if __name__ == &#39;__main__&#39;: main() And voila ! $ curl http://localhost:9200/vuln_2018-11-25/_search?pretty | jq -r . { &#34;took&#34;: 0, &#34;timed_out&#34;: false, &#34;_shards&#34;: { &#34;total&#34;: 5, &#34;successful&#34;: 5, &#34;skipped&#34;: 0, &#34;failed&#34;: 0 }, &#34;hits&#34;: { &#34;total&#34;: 3, &#34;max_score&#34;: 1, &#34;hits&#34;: [ { &#34;_index&#34;: &#34;index_name_2018-11-25&#34;, &#34;_type&#34;: &#34;vuln&#34;, &#34;_id&#34;: &#34;0&#34;, &#34;_score&#34;: 1, &#34;_source&#34;: { &#34;Column1&#34;: 1, &#34;Column2&#34;: 2, &#34;Column3&#34;: 3, } }, { &#34;_index&#34;: &#34;index_name_2018-11-25&#34;, &#34;_type&#34;: &#34;vuln&#34;, &#34;_id&#34;: &#34;1&#34;, &#34;_score&#34;: 1, &#34;_source&#34;: { &#34;Column1&#34;: &#34;a&#34;, &#34;Column2&#34;: &#34;b&#34;, &#34;Column3&#34;: &#34;c&#34;, } }, { &#34;_index&#34;: &#34;index_name_2018-11-25&#34;, &#34;_type&#34;: &#34;vuln&#34;, &#34;_id&#34;: &#34;2&#34;, &#34;_score&#34;: 1, &#34;_source&#34;: { &#34;Column1&#34;: &#34;blih&#34;, &#34;Column2&#34;: &#34;blah&#34;, &#34;Column3&#34;: &#34;bluh&#34;, } } ] } } After that you just need to install Kibana and enjoy your graphs, tables and so on in a more collaborative way, dynamic filters etc." />
<meta name="keywords" content="elasticsearch, kibana, python, pandas, data">

<meta property="og:site_name" content="A Pelican Blog"/>
<meta property="og:title" content="CSV to Elasticsearch in order to replace your Excel with Kibana"/>
<meta property="og:description" content="Last night, I was asked if I could setup some frontend to make some stats out of a CSV. In a more interactive and collaborative way than Excel. I was first asked to do a small Django project since it used to be my goto technology at the time. But for this need, the use of Elasticsearch was perfect and Kibana helped me to not develop any frontend and solve a lot of time. The CSV export looked like this but had at least 30 columns and 200k lines: Column1;Colum2;Column3 1;2;3 a;b;c blih;blah;bluh Python way to push the CSV to Elasticsearch Elasticsearch requires JSON documents, so the first step was to convert the CSV to json. Instead of writing a CSV to JSON parser, I used the pandas library which makes the whole process a lot easier and faster (the csv file had hundreds of thousands of lines). And by looking at the official elasticsearch python SDK, I just needed to transform the whole CSV into a dict. import sys import pandas as pd import argparse from elasticsearch import Elasticsearch, helpers def main(): parser = argparse.ArgumentParser(description=&#39;Process some integers.&#39;) parser.add_argument(&#39;filename&#39;, type=str, help=&#39;filename to parse&#39;) parser.add_argument(&#39;index&#39;, type=str, help=&#39;index name to use&#39;) args = parser.parse_args() filename = args.filename index_name = args.index # initiate Elasticsearch connection es = Elasticsearch() # parse the csv with pandas df = pd.read_csv(filename, sep=&#39;;&#39;, error_bad_lines=False) # trim whitespace and stuff data_frame_trimmed = df.apply(lambda x: x.str.strip() if x.dtype == &#34;object&#34; else x) # replace `nan` values with empty string data_frame_trimmed = df.fillna(&#39;&#39;) # transform the whole data frame into a huge python dict records = data_frame_trimmed.to_dict(orient=&#39;records&#39;) # use bulk actions to push the data actions = [] for i, r in enumerate(records): actions.append({&#34;_index&#34;: index_name, &#34;_type&#34;: &#34;vuln&#34;, &#34;_id&#34;: i, &#34;_source&#34;: r}) ret = helpers.bulk(es, actions=actions) print(ret) if __name__ == &#39;__main__&#39;: main() And voila ! $ curl http://localhost:9200/vuln_2018-11-25/_search?pretty | jq -r . { &#34;took&#34;: 0, &#34;timed_out&#34;: false, &#34;_shards&#34;: { &#34;total&#34;: 5, &#34;successful&#34;: 5, &#34;skipped&#34;: 0, &#34;failed&#34;: 0 }, &#34;hits&#34;: { &#34;total&#34;: 3, &#34;max_score&#34;: 1, &#34;hits&#34;: [ { &#34;_index&#34;: &#34;index_name_2018-11-25&#34;, &#34;_type&#34;: &#34;vuln&#34;, &#34;_id&#34;: &#34;0&#34;, &#34;_score&#34;: 1, &#34;_source&#34;: { &#34;Column1&#34;: 1, &#34;Column2&#34;: 2, &#34;Column3&#34;: 3, } }, { &#34;_index&#34;: &#34;index_name_2018-11-25&#34;, &#34;_type&#34;: &#34;vuln&#34;, &#34;_id&#34;: &#34;1&#34;, &#34;_score&#34;: 1, &#34;_source&#34;: { &#34;Column1&#34;: &#34;a&#34;, &#34;Column2&#34;: &#34;b&#34;, &#34;Column3&#34;: &#34;c&#34;, } }, { &#34;_index&#34;: &#34;index_name_2018-11-25&#34;, &#34;_type&#34;: &#34;vuln&#34;, &#34;_id&#34;: &#34;2&#34;, &#34;_score&#34;: 1, &#34;_source&#34;: { &#34;Column1&#34;: &#34;blih&#34;, &#34;Column2&#34;: &#34;blah&#34;, &#34;Column3&#34;: &#34;bluh&#34;, } } ] } } After that you just need to install Kibana and enjoy your graphs, tables and so on in a more collaborative way, dynamic filters etc."/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://blog.solvik.fr/csv-to-elasticsearch-in-order-to-replace-your-excel-with-kibana.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2018-11-25 15:00:00+01:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://blog.solvik.fr/author/solvik-blum.html">
<meta property="article:section" content="Python"/>
<meta property="article:tag" content="elasticsearch"/>
<meta property="article:tag" content="kibana"/>
<meta property="article:tag" content="python"/>
<meta property="article:tag" content="pandas"/>
<meta property="article:tag" content="data"/>
<meta property="og:image" content="https://en.gravatar.com/userimage/144533955/56e59d953cf9667fa0206fdd677aa7cc.jpg?size=200">

  <title>A Pelican Blog &ndash; CSV to Elasticsearch in order to replace your Excel with Kibana</title>

</head>
<body>
  <aside>
    <div>
      <a href="https://blog.solvik.fr">
        <img src="https://en.gravatar.com/userimage/144533955/56e59d953cf9667fa0206fdd677aa7cc.jpg?size=200" alt="/home/solvik" title="/home/solvik">
      </a>
      <h1><a href="https://blog.solvik.fr">/home/solvik</a></h1>

<p>my place of sharing</p>
      <nav>
        <ul class="list">
          <li><a href="https://blog.solvik.fr/pages/about.html#about">About</a></li>

        </ul>
      </nav>

      <ul class="social">
        <li><a class="sc-linkedin" href="https://www.linkedin.com/in/solvikblum" target="_blank"><i class="fa fa-linkedin"></i></a></li>
        <li><a class="sc-twitter" href="https://twitter.com/solvik" target="_blank"><i class="fa fa-twitter"></i></a></li>
        <li><a class="sc-github" href="https://github.com/Solvik" target="_blank"><i class="fa fa-github"></i></a></li>
      </ul>
    </div>


  </aside>
  <main>

    <nav>
      <a href="https://blog.solvik.fr">    Home
</a>

      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>

      <a href="https://blog.solvik.fr/feeds/all.atom.xml">    Atom
</a>

    </nav>

<article class="single">
  <header>
      
    <h1 id="csv-to-elasticsearch-in-order-to-replace-your-excel-with-kibana">CSV to Elasticsearch in order to replace your Excel with Kibana</h1>
    <p>
          Posted on novembre 25, 2018 in <a href="https://blog.solvik.fr/category/python.html">Python</a>


    </p>
  </header>


  <div>
    <p>Last night, I was asked if I could setup some frontend to make some stats out of a CSV.
In a more interactive and collaborative way than Excel.</p>
<p>I was first asked to do a small Django project since it used to be my goto technology at the time.</p>
<p>But for this need, the use of <a href="https://www.elastic.co/fr/products/elasticsearch">Elasticsearch</a> was perfect and <a href="https://www.elastic.co/fr/products/kibana">Kibana</a> helped me to not develop any frontend and solve a lot of time.</p>
<p>The CSV export looked like this but had at least 30 columns and 200k lines:</p>
<div class="highlight"><pre><span></span>Column1;Colum2;Column3
1;2;3
a;b;c
blih;blah;bluh
</pre></div>


<h2>Python way to push the CSV to Elasticsearch</h2>
<p>Elasticsearch requires JSON documents, so the first step was to convert the CSV to <em>json</em>.</p>
<p>Instead of writing a CSV to JSON parser, I used the <a href="https://pandas.pydata.org/">pandas</a> library which makes the whole process a lot easier and faster (the csv file had hundreds of thousands of lines).</p>
<p>And by looking at the official elasticsearch python SDK, I just needed to transform the whole CSV into a dict.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">from</span> <span class="nn">elasticsearch</span> <span class="kn">import</span> <span class="n">Elasticsearch</span><span class="p">,</span> <span class="n">helpers</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Process some integers.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;filename to parse&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;index name to use&#39;</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">filename</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">filename</span>
    <span class="n">index_name</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">index</span>

    <span class="c1"># initiate Elasticsearch connection</span>
    <span class="n">es</span> <span class="o">=</span> <span class="n">Elasticsearch</span><span class="p">()</span>

    <span class="c1"># parse the csv with pandas</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">error_bad_lines</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="c1"># trim whitespace and stuff</span>
    <span class="n">data_frame_trimmed</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;object&quot;</span> <span class="k">else</span> <span class="n">x</span><span class="p">)</span>
    <span class="c1"># replace `nan` values with empty string</span>
    <span class="n">data_frame_trimmed</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="c1"># transform the whole data frame into a huge python dict</span>
    <span class="n">records</span> <span class="o">=</span> <span class="n">data_frame_trimmed</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;records&#39;</span><span class="p">)</span>

    <span class="c1"># use bulk actions to push the data</span>
    <span class="n">actions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">records</span><span class="p">):</span>
    <span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;_index&quot;</span><span class="p">:</span> <span class="n">index_name</span><span class="p">,</span>
            <span class="s2">&quot;_type&quot;</span><span class="p">:</span> <span class="s2">&quot;vuln&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span>
            <span class="s2">&quot;_source&quot;</span><span class="p">:</span> <span class="n">r</span><span class="p">})</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">helpers</span><span class="o">.</span><span class="n">bulk</span><span class="p">(</span><span class="n">es</span><span class="p">,</span> <span class="n">actions</span><span class="o">=</span><span class="n">actions</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>


<p>And voila !</p>
<div class="highlight"><pre><span></span>$ curl http://localhost:9200/vuln_2018-11-25/_search?pretty <span class="p">|</span> jq -r .
<span class="o">{</span>
  <span class="s2">&quot;took&quot;</span>: <span class="m">0</span>,
  <span class="s2">&quot;timed_out&quot;</span>: false,
  <span class="s2">&quot;_shards&quot;</span>: <span class="o">{</span>
<span class="s2">&quot;total&quot;</span>: <span class="m">5</span>,
<span class="s2">&quot;successful&quot;</span>: <span class="m">5</span>,
<span class="s2">&quot;skipped&quot;</span>: <span class="m">0</span>,
<span class="s2">&quot;failed&quot;</span>: <span class="m">0</span>
  <span class="o">}</span>,
  <span class="s2">&quot;hits&quot;</span>: <span class="o">{</span>
<span class="s2">&quot;total&quot;</span>: <span class="m">3</span>,
<span class="s2">&quot;max_score&quot;</span>: <span class="m">1</span>,
<span class="s2">&quot;hits&quot;</span>: <span class="o">[</span>
  <span class="o">{</span>
    <span class="s2">&quot;_index&quot;</span>: <span class="s2">&quot;index_name_2018-11-25&quot;</span>,
    <span class="s2">&quot;_type&quot;</span>: <span class="s2">&quot;vuln&quot;</span>,
    <span class="s2">&quot;_id&quot;</span>: <span class="s2">&quot;0&quot;</span>,
    <span class="s2">&quot;_score&quot;</span>: <span class="m">1</span>,
    <span class="s2">&quot;_source&quot;</span>: <span class="o">{</span>
      <span class="s2">&quot;Column1&quot;</span>: <span class="m">1</span>,
      <span class="s2">&quot;Column2&quot;</span>: <span class="m">2</span>,
      <span class="s2">&quot;Column3&quot;</span>: <span class="m">3</span>,
    <span class="o">}</span>
  <span class="o">}</span>,
  <span class="o">{</span>
    <span class="s2">&quot;_index&quot;</span>: <span class="s2">&quot;index_name_2018-11-25&quot;</span>,
    <span class="s2">&quot;_type&quot;</span>: <span class="s2">&quot;vuln&quot;</span>,
    <span class="s2">&quot;_id&quot;</span>: <span class="s2">&quot;1&quot;</span>,
    <span class="s2">&quot;_score&quot;</span>: <span class="m">1</span>,
    <span class="s2">&quot;_source&quot;</span>: <span class="o">{</span>
      <span class="s2">&quot;Column1&quot;</span>: <span class="s2">&quot;a&quot;</span>,
      <span class="s2">&quot;Column2&quot;</span>: <span class="s2">&quot;b&quot;</span>,
      <span class="s2">&quot;Column3&quot;</span>: <span class="s2">&quot;c&quot;</span>,
    <span class="o">}</span>
  <span class="o">}</span>,
  <span class="o">{</span>
    <span class="s2">&quot;_index&quot;</span>: <span class="s2">&quot;index_name_2018-11-25&quot;</span>,
    <span class="s2">&quot;_type&quot;</span>: <span class="s2">&quot;vuln&quot;</span>,
    <span class="s2">&quot;_id&quot;</span>: <span class="s2">&quot;2&quot;</span>,
    <span class="s2">&quot;_score&quot;</span>: <span class="m">1</span>,
    <span class="s2">&quot;_source&quot;</span>: <span class="o">{</span>
      <span class="s2">&quot;Column1&quot;</span>: <span class="s2">&quot;blih&quot;</span>,
      <span class="s2">&quot;Column2&quot;</span>: <span class="s2">&quot;blah&quot;</span>,
      <span class="s2">&quot;Column3&quot;</span>: <span class="s2">&quot;bluh&quot;</span>,
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">]</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>After that you just need to install Kibana and enjoy your graphs, tables and so on in a more collaborative way, dynamic filters etc.</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://blog.solvik.fr/tag/elasticsearch.html">elasticsearch</a>
      <a href="https://blog.solvik.fr/tag/kibana.html">kibana</a>
      <a href="https://blog.solvik.fr/tag/python.html">python</a>
      <a href="https://blog.solvik.fr/tag/pandas.html">pandas</a>
      <a href="https://blog.solvik.fr/tag/data.html">data</a>
    </p>
  </div>





</article>

    <footer>
<p>
  &copy;  2018 - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>
</p>
<p>    Powered by <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a>
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " A Pelican Blog ",
  "url" : "https://blog.solvik.fr",
  "image": "https://en.gravatar.com/userimage/144533955/56e59d953cf9667fa0206fdd677aa7cc.jpg?size=200",
  "description": ""
}
</script>

</body>
</html>